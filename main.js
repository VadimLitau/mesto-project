(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{h:()=>I,x:()=>q});var t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-4",headers:{authorization:"69b55c42-ee88-4348-a639-420f0f40fb4f","Content-Type":"application/json"}};function o(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}var n=function(e,n,r,c){return fetch("".concat(t.baseUrl,"/users/me/")+n,{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e,name:r.value,about:c.value})}).then(o)},r=function(e,n){return fetch("".concat(t.baseUrl,"/cards/likes/")+e,{method:n,headers:t.headers}).then(o)},c=function(){return Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(o),fetch("".concat(t.baseUrl,"/cards/"),{headers:t.headers}).then(o)])},u=document.querySelector(".popup_AddCard"),a=document.querySelector(".profile__button"),l=(document.querySelector(".popup_AddCard_cross"),document.querySelector("#photo-gallery__element").content),i=document.querySelector(".popup__form"),s=document.querySelector("#popup__idName"),p=document.querySelector("#popupAddCard__firstInput"),d=document.querySelector("#popupAddCard__secondInput"),_=document.querySelector(".gallery-element"),m=document.querySelector(".popup__photo"),f=document.querySelector(".popup__photo-image"),v=document.querySelector(".popup__photo-name"),y=(document.querySelector(".popup_photo_cross"),document.querySelector(".popup_deleteCard")),h=(document.querySelector(".popup__deleteCard_btn"),function(e,n,c,u,a,i){var s=l.querySelector(".gallery-element__item").cloneNode(!0),p=s.querySelector(".gallery-element__photo"),d=s.querySelector(".gallery-element__caption-name"),_=s.querySelector(".gallery-element__caption-like"),h=s.querySelector(".gallery-element__deletCard"),S=s.querySelector(".gallery-element__like-counter");return p.alt=n,p.src=e,d.textContent=n,S.textContent=c,s.id=a,i&&_.classList.add("gallery-element__caption-like_active"),_.addEventListener("click",(function(){_.classList.contains("gallery-element__caption-like_active")?r(a,"DELETE").then((function(e){S.textContent=e.likes.length,_.classList.remove("gallery-element__caption-like_active")})).catch((function(e){console.log(e)})):r(a,"PUT").then((function(e){S.textContent=e.likes.length,_.classList.add("gallery-element__caption-like_active")})).catch((function(e){console.log(e)}))})),u===q?h.classList.remove("gallery-element__deletCard_notDelete"):h.classList.add("gallery-element__deletCard_notDelete"),h.addEventListener("click",(function(){var e,n;C(y),(n=(e=s).id,fetch("".concat(t.baseUrl,"/cards/")+n,{method:"DELETE",headers:t.headers}).then(o)).then((function(t){b(y),e.remove()}))})),p.addEventListener("click",(function(){C(m),f.alt=p.alt,f.src=p.src,v.textContent=d.textContent})),s});c().then((function(e){console.log(e),e[1].reverse().forEach((function(e){var t;e.likes.forEach((function(e){return q===e._id?t=1:t})),_.prepend(h(e.link,e.name,e.likes.length,e.owner._id,e._id,t))}))})).catch((function(e){console.log(e)}));function S(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");b(t)}}var q,C=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",S)},b=function(e,t,o,n){t?(o.textContent=n,setTimeout((function(){e.classList.remove("popup_opened")}),t)):e.classList.remove("popup_opened"),document.removeEventListener("keydown",S)},L=function(e,t){e.some((function(e){return!e.validity.valid}))?(t.classList.add(g.inactiveButtonClass),t.type="button"):(t.classList.remove(g.inactiveButtonClass),t.type="submit")},g={formSelector:".popup__form",inputSelector:".popup__form-input",submitButtonSelector:".popup__form-button",inactiveButtonClass:"popup__form-button_disabled",inputErrorClass:"popup__form-input_type_error",inputErrorClassActive:"popup__form-input-error_active",errorClass:"popup__error_visible"},E=document.querySelector(".profile__info-name"),k=document.querySelector(".profile__info-profession"),x=document.querySelector(".profile__info-button"),A=(document.querySelector(".popup__cross"),document.querySelector(".popup_profile")),T=document.querySelector("#popup__idProfession"),P=document.querySelector(".popup_editAvatar"),U=document.querySelector(".profile__avatar-wrap-edit"),w=document.querySelector(".popup_editAvatar_btn"),D=document.querySelector(".popup_AddCard_form-button"),O=document.querySelector(".popup__form-button_profile"),j=document.querySelector(".profile__info-name"),B=document.querySelector(".profile__info-profession"),N=document.querySelector(".profile__avatar");c().then((function(e){return j.textContent=e[0].name,B.textContent=e[0].about,N.src=e[0].avatar,q=e[0]._id})).catch((function(e){console.log(e)}));var I=2e3;U.addEventListener("click",(function(){C(P),w.textContent="Сохранить",w.type="button",w.classList.add("popup__form-button_disabled"),document.querySelector("#popup_editAvatar").value=""})),w.addEventListener("click",(function(){var e=document.querySelector("#popup_editAvatar").value;b(P,I,w,"Сохранение..."),setTimeout((function(){n(e,"avatar","","").then((function(e){document.querySelector(".profile__avatar").src=e.avatar})).catch((function(e){console.log(e)}))}),I)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup__cross")||t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__photo_wrap"))&&b(e)}))})),x.addEventListener("click",(function(){C(A),s.value=E.textContent,T.value=k.textContent,O.textContent="Сохранить"})),a.addEventListener("click",(function(){C(u),d.value="",p.value="",D.textContent="Создать",D.classList.add("popup__form-button_disabled"),D.type="button"})),i.addEventListener("submit",(function(e){b(A,I,O,"Сохранение..."),setTimeout((function(){n("","",s,T),E.textContent=s.value,k.textContent=T.value}),I),e.preventDefault()})),u.addEventListener("submit",(function(e){var n,r,c;b(u,I,D,"Сохранение..."),n=d.value,r=p.value,c=I,function(e,n){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n,link:e})}).then(o)}(n,r).then((function(e){setTimeout((function(){_.prepend(h(e.link,e.name,"0",e.owner._id,e._id))}),c)})).catch((function(e){console.log(e)})),e.preventDefault()})),Array.from(document.querySelectorAll(g.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(g.inputSelector)),o=e.querySelector(g.submitButtonSelector);L(t,o),t.forEach((function(n){n.addEventListener("input",(function(){(function(e,t){t.validity.valid?function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(g.inputErrorClass),o.textContent="",o.classList.remove(g.inputErrorClassActive)}(e,t):function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(g.inputErrorClass),n.textContent=o,n.classList.add(g.inputErrorClassActive)}(e,t,t.validationMessage)})(e,n),L(t,o)}))}))}(e)})),console.log(q)})();