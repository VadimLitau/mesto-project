(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{h:()=>w,V:()=>N});var t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-4",headers:{authorization:"69b55c42-ee88-4348-a639-420f0f40fb4f","Content-Type":"application/json"}};function o(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}var n,r=function(e,n,r,c){return fetch("".concat(t.baseUrl,"/users/me/")+n,{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e,name:r.value,about:c.value})}).then(o)},c=function(e,n){return fetch("".concat(t.baseUrl,"/cards/likes/")+e,{method:n,headers:t.headers}).then(o)},a=function(){return Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(o),fetch("".concat(t.baseUrl,"/cards/"),{headers:t.headers}).then(o)])},u=document.querySelector(".popup_AddCard"),l=document.querySelector(".profile__button"),i=(document.querySelector(".popup_AddCard_cross"),document.querySelector("#photo-gallery__element").content),s=document.querySelector(".popup__form"),p=document.querySelector("#popup__idName"),d=document.querySelector("#popupAddCard__firstInput"),_=document.querySelector("#popupAddCard__secondInput"),f=document.querySelector(".gallery-element"),m=document.querySelector(".popup__photo"),v=document.querySelector(".popup__photo-image"),y=document.querySelector(".popup__photo-name"),h=(document.querySelector(".popup_photo_cross"),document.querySelector(".popup_deleteCard"),document.querySelector(".popup__deleteCard_btn"),function(e,r,a,u,l,s){var p=i.querySelector(".gallery-element__item").cloneNode(!0),d=p.querySelector(".gallery-element__photo"),_=p.querySelector(".gallery-element__caption-name"),f=p.querySelector(".gallery-element__caption-like"),h=p.querySelector(".gallery-element__deletCard"),S=p.querySelector(".gallery-element__like-counter");return d.alt=r,d.src=e,_.textContent=r,S.textContent=a,p.id=l,s&&f.classList.add("gallery-element__caption-like_active"),f.addEventListener("click",(function(){f.classList.contains("gallery-element__caption-like_active")?c(l,"DELETE").then((function(e){S.textContent=e.likes.length,f.classList.remove("gallery-element__caption-like_active")})).catch((function(e){console.log(e)})):c(l,"PUT").then((function(e){S.textContent=e.likes.length,f.classList.add("gallery-element__caption-like_active")})).catch((function(e){console.log(e)}))})),u===n?h.classList.remove("gallery-element__deletCard_notDelete"):h.classList.add("gallery-element__deletCard_notDelete"),h.addEventListener("click",(function(){var e,n;(n=(e=p).id,fetch("".concat(t.baseUrl,"/cards/")+n,{method:"DELETE",headers:t.headers}).then(o)).then((function(t){e.remove()})).catch((function(e){console.log(e)}))})),d.addEventListener("click",(function(){q(m),v.alt=d.alt,v.src=d.src,y.textContent=_.textContent})),p});a().then((function(e){n=e[0]._id,e[1].reverse().forEach((function(e){var t;e.likes.forEach((function(e){return n===e._id?t=1:t})),f.prepend(h(e.link,e.name,e.likes.length,e.owner._id,e._id,t))}))})).catch((function(e){console.log(e)}));function S(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");C(t)}}var q=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",S)},C=function(e,t){t?setTimeout((function(){e.classList.remove("popup_opened")}),t):e.classList.remove("popup_opened"),document.removeEventListener("keydown",S)},b=function(e,t){e.some((function(e){return!e.validity.valid}))?(t.classList.add(L.inactiveButtonClass),t.type="button"):(t.classList.remove(L.inactiveButtonClass),t.type="submit")},L={formSelector:".popup__form",inputSelector:".popup__form-input",submitButtonSelector:".popup__form-button",inactiveButtonClass:"popup__form-button_disabled",inputErrorClass:"popup__form-input_type_error",inputErrorClassActive:"popup__form-input-error_active",errorClass:"popup__error_visible"},g=document.querySelector(".profile__info-name"),E=document.querySelector(".profile__info-profession"),k=document.querySelector(".profile__info-button"),x=(document.querySelector(".popup__cross"),document.querySelector(".popup_profile")),A=document.querySelector("#popup__idProfession"),T=document.querySelector(".popup_editAvatar"),P=document.querySelector(".profile__avatar-wrap-edit"),U=document.querySelector(".popup_editAvatar_btn"),w=document.querySelector(".popup_AddCard_form-button"),D=document.querySelector(".popup__form-button_profile"),O=document.querySelector(".profile__info-name"),j=document.querySelector(".profile__info-profession"),B=document.querySelector(".profile__avatar");a().then((function(e){O.textContent=e[0].name,j.textContent=e[0].about,B.src=e[0].avatar})).catch((function(e){console.log(e)}));var N=2e3;P.addEventListener("click",(function(){q(T),U.textContent="Сохранить",U.type="button",document.querySelector("#popup_editAvatar").value="",U.classList.add("popup__form-button_disabled")})),U.addEventListener("click",(function(){var e=document.querySelector("#popup_editAvatar").value;r(e,"avatar","","").then((function(e){setTimeout((function(){document.querySelector(".profile__avatar").src=e.avatar}),N)})).catch((function(e){console.log(e)})).finally(C(T,N),U.textContent="Сохранение...")})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup__cross")||t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__photo_wrap"))&&C(e)}))})),k.addEventListener("click",(function(){q(x),p.value=g.textContent,A.value=E.textContent,D.textContent="Сохранить"})),l.addEventListener("click",(function(){q(u),_.value="",d.value="",w.textContent="Создать",w.classList.add("popup__form-button_disabled"),w.type="button"})),s.addEventListener("submit",(function(e){r("","",p,A).then((function(e){setTimeout((function(){g.textContent=p.value,E.textContent=A.value}),N)})).catch((function(e){console.log(e)})).finally(C(x,N),D.textContent="Сохранение..."),e.preventDefault()})),u.addEventListener("submit",(function(e){var n,r,c;n=_.value,r=d.value,c=N,function(e,n){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n,link:e})}).then(o)}(n,r).then((function(e){setTimeout((function(){f.prepend(h(e.link,e.name,"0",e.owner._id,e._id))}),c)})).catch((function(e){console.log(e)})).finally(C(u,N,w.textContent="Сохранение...")),e.preventDefault()})),Array.from(document.querySelectorAll(L.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(L.inputSelector)),o=e.querySelector(L.submitButtonSelector);b(t,o),t.forEach((function(n){n.addEventListener("input",(function(){(function(e,t){t.validity.valid?function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(L.inputErrorClass),o.textContent="",o.classList.remove(L.inputErrorClassActive)}(e,t):function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(L.inputErrorClass),n.textContent=o,n.classList.add(L.inputErrorClassActive)}(e,t,t.validationMessage)})(e,n),b(t,o)}))}))}(e)}))})();